import { createRequire as _createRequire } from 'node:module';
const require = _createRequire(import.meta.url);
import{c as le,g as ye,h as ve,i as ge,j as gt}from"./chunk-NX7YLKSA.js";import{a as R,b as Y,d as me,e as fe,j as pe,l as Et,m as U,n as M,o as q,p as de,q as he,t as z,w as vt}from"./chunk-TISVPECQ.js";import{b as Ct,j as At,k as B}from"./chunk-KHHAS67O.js";import{e as Nt,f as yt,g as Z,i as Ft}from"./chunk-FCAB5YK5.js";import{a as f,b as L}from"./chunk-TEVFRW7G.js";import{a as T,c as l,e as g}from"./chunk-JOXYEZYT.js";import{a as J,c as N,e as d,g as __dirname,i as a}from"./chunk-UO4ZAUJK.js";var _e=N((dn,Ae)=>{"use strict";a();function w(t,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(t)),this._timeouts=t,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}Ae.exports=w;w.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};w.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};w.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;var e=new Date().getTime();if(t&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(t),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(t);var r=this._timeouts.shift();if(r===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1);else return!1;var o=this;return this._timer=setTimeout(function(){o._attempts++,o._operationTimeoutCb&&(o._timeout=setTimeout(function(){o._operationTimeoutCb(o._attempts)},o._operationTimeout),o._options.unref&&o._timeout.unref()),o._fn(o._attempts)},r),this._options.unref&&this._timer.unref(),!0};w.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};w.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)};w.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)};w.prototype.start=w.prototype.try;w.prototype.errors=function(){return this._errors};w.prototype.attempts=function(){return this._attempts};w.prototype.mainError=function(){if(this._errors.length===0)return null;for(var t={},e=null,r=0,o=0;o<this._errors.length;o++){var n=this._errors[o],s=n.message,i=(t[s]||0)+1;t[s]=i,i>=r&&(e=n,r=i)}return e}});var xe=N(F=>{"use strict";a();var jr=_e();F.operation=function(t){var e=F.timeouts(t);return new jr(e,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})};F.timeouts=function(t){if(t instanceof Array)return[].concat(t);var e={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var r in t)e[r]=t[r];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var o=[],n=0;n<e.retries;n++)o.push(this.createTimeout(n,e));return t&&t.forever&&!o.length&&o.push(this.createTimeout(n,e)),o.sort(function(s,i){return s-i}),o};F.createTimeout=function(t,e){var r=e.randomize?Math.random()+1:1,o=Math.round(r*Math.max(e.minTimeout,1)*Math.pow(e.factor,t));return o=Math.min(o,e.maxTimeout),o};F.wrap=function(t,e,r){if(e instanceof Array&&(r=e,e=null),!r){r=[];for(var o in t)typeof t[o]=="function"&&r.push(o)}for(var n=0;n<r.length;n++){var s=r[n],i=t[s];t[s]=function(u){var m=F.operation(e),p=Array.prototype.slice.call(arguments,1),h=p.pop();p.push(function(y){m.retry(y)||(y&&(arguments[0]=m.mainError()),h.apply(this,arguments))}),m.attempt(function(){u.apply(t,p)})}.bind(t,i),t[s].options=e}}});var Se=N((vn,we)=>{"use strict";a();we.exports=xe()});var ee=N((si,Ar)=>{"use strict";a();var gr=J("fs"),te;function Yo(){try{return gr.statSync("/.dockerenv"),!0}catch{return!1}}function Zo(){try{return gr.readFileSync("/proc/self/cgroup","utf8").includes("docker")}catch{return!1}}Ar.exports=()=>(te===void 0&&(te=Yo()||Zo()),te)});var wr=N((ci,re)=>{"use strict";a();var Qo=J("os"),tn=J("fs"),_r=ee(),xr=()=>{if(process.platform!=="linux")return!1;if(Qo.release().toLowerCase().includes("microsoft"))return!_r();try{return tn.readFileSync("/proc/version","utf8").toLowerCase().includes("microsoft")?!_r():!1}catch{return!1}};process.env.__IS_WSL_TEST__?re.exports=xr:re.exports=xr()});var Rr=N((mi,Sr)=>{"use strict";a();Sr.exports=(t,e,r)=>{let o=n=>Object.defineProperty(t,e,{value:n,enumerable:!0,writable:!0});return Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get(){let n=r();return o(n),n},set(n){o(n)}}),t}});var Er=N((pi,kr)=>{"use strict";a();var en=J("path"),rn=J("child_process"),{promises:Pt,constants:qr}=J("fs"),bt=wr(),on=ee(),ne=Rr(),Tr=en.join(__dirname,"xdg-open"),{platform:G,arch:br}=process,nn=()=>{try{return Pt.statSync("/run/.containerenv"),!0}catch{return!1}},oe;function an(){return oe===void 0&&(oe=nn()||on()),oe}var sn=(()=>{let t="/mnt/",e;return async function(){if(e)return e;let r="/etc/wsl.conf",o=!1;try{await Pt.access(r,qr.F_OK),o=!0}catch{}if(!o)return t;let n=await Pt.readFile(r,{encoding:"utf8"}),s=/(?<!#.*)root\s*=\s*(?<mountPoint>.*)/g.exec(n);return s?(e=s.groups.mountPoint.trim(),e=e.endsWith("/")?e:`${e}/`,e):t}})(),Pr=async(t,e)=>{let r;for(let o of t)try{return await e(o)}catch(n){r=n}throw r},Ot=async t=>{if(t={wait:!1,background:!1,newInstance:!1,allowNonzeroExitCode:!1,...t},Array.isArray(t.app))return Pr(t.app,c=>Ot({...t,app:c}));let{name:e,arguments:r=[]}=t.app||{};if(r=[...r],Array.isArray(e))return Pr(e,c=>Ot({...t,app:{name:c,arguments:r}}));let o,n=[],s={};if(G==="darwin")o="open",t.wait&&n.push("--wait-apps"),t.background&&n.push("--background"),t.newInstance&&n.push("--new"),e&&n.push("-a",e);else if(G==="win32"||bt&&!an()&&!e){let c=await sn();o=bt?`${c}c/Windows/System32/WindowsPowerShell/v1.0/powershell.exe`:`${process.env.SYSTEMROOT}\\System32\\WindowsPowerShell\\v1.0\\powershell`,n.push("-NoProfile","-NonInteractive","\u2013ExecutionPolicy","Bypass","-EncodedCommand"),bt||(s.windowsVerbatimArguments=!0);let u=["Start"];t.wait&&u.push("-Wait"),e?(u.push(`"\`"${e}\`""`,"-ArgumentList"),t.target&&r.unshift(t.target)):t.target&&u.push(`"${t.target}"`),r.length>0&&(r=r.map(m=>`"\`"${m}\`""`),u.push(r.join(","))),t.target=Buffer.from(u.join(" "),"utf16le").toString("base64")}else{if(e)o=e;else{let c=!__dirname||__dirname==="/",u=!1;try{await Pt.access(Tr,qr.X_OK),u=!0}catch{}o=process.versions.electron||G==="android"||c||!u?"xdg-open":Tr}r.length>0&&n.push(...r),t.wait||(s.stdio="ignore",s.detached=!0)}t.target&&n.push(t.target),G==="darwin"&&r.length>0&&n.push("--args",...r);let i=rn.spawn(o,n,s);return t.wait?new Promise((c,u)=>{i.once("error",u),i.once("close",m=>{if(!t.allowNonzeroExitCode&&m>0){u(new Error(`Exited with code ${m}`));return}c(i)})}):(i.unref(),i)},ae=(t,e)=>{if(typeof t!="string")throw new TypeError("Expected a `target`");return Ot({...e,target:t})},cn=(t,e)=>{if(typeof t!="string")throw new TypeError("Expected a `name`");let{arguments:r=[]}=e||{};if(r!=null&&!Array.isArray(r))throw new TypeError("Expected `appArguments` as Array type");return Ot({...e,app:{name:t,arguments:r}})};function Or(t){if(typeof t=="string"||Array.isArray(t))return t;let{[br]:e}=t;if(!e)throw new Error(`${br} is not supported`);return e}function se({[G]:t},{wsl:e}){if(e&&bt)return Or(e);if(!t)throw new Error(`${G} is not supported`);return Or(t)}var qt={};ne(qt,"chrome",()=>se({darwin:"google chrome",win32:"chrome",linux:["google-chrome","google-chrome-stable","chromium"]},{wsl:{ia32:"/mnt/c/Program Files (x86)/Google/Chrome/Application/chrome.exe",x64:["/mnt/c/Program Files/Google/Chrome/Application/chrome.exe","/mnt/c/Program Files (x86)/Google/Chrome/Application/chrome.exe"]}}));ne(qt,"firefox",()=>se({darwin:"firefox",win32:"C:\\Program Files\\Mozilla Firefox\\firefox.exe",linux:"firefox"},{wsl:"/mnt/c/Program Files/Mozilla Firefox/firefox.exe"}));ne(qt,"edge",()=>se({darwin:"microsoft edge",win32:"msedge",linux:["microsoft-edge","microsoft-edge-dev"]},{wsl:"/mnt/c/Program Files (x86)/Microsoft/Edge/Application/msedge.exe"}));ae.apps=qt;ae.openApp=cn;kr.exports=ae});a();a();a();var nr=d(T(),1);a();a();var Te=d(Se(),1),Wr=new Set(["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed"]),It=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}},$r=(t,e,r)=>{let o=r.retries-(e-1);return t.attemptNumber=e,t.retriesLeft=o,t},Gr=t=>Wr.has(t),Re=t=>globalThis.DOMException===void 0?new Error(t):new DOMException(t);async function Q(t,e){return new Promise((r,o)=>{e={onFailedAttempt(){},retries:10,...e};let n=Te.default.operation(e);n.attempt(async s=>{try{r(await t(s))}catch(i){if(!(i instanceof Error)){o(new TypeError(`Non-error was thrown: "${i}". You should only throw errors.`));return}if(i instanceof It)n.stop(),o(i.originalError);else if(i instanceof TypeError&&!Gr(i.message))n.stop(),o(i);else{$r(i,s,e);try{await e.onFailedAttempt(i)}catch(c){o(c);return}n.retry(i)||o(n.mainError())}}}),e.signal&&!e.signal.aborted&&e.signal.addEventListener("abort",()=>{n.stop();let s=e.signal.reason===void 0?Re("The operation was aborted."):e.signal.reason;o(s instanceof Error?s:Re(s))},{once:!0})})}a();a();a();a();function be(t=""){let[e,r]=Xr(t);return r?{schemaName:r,schemaType:e}:{schemaName:e}}var Xr=t=>t.split("#");a();a();function Pe(t,e,r,o){let n=t;for(let s of e.split(".")){if(!n)return r;n=n[s]}return`${n}${o}`}var Yr="_",Zr=["wix.com","editorx.com"],Qr=["42.wixprod.net","uw2-edt-1.wixprod.net"],to="dev.wix-code.com",eo=/{(.*)}/,ro=new RegExp(`\\.(${Zr.join("|")})$`),oo=new RegExp(`\\.(${Qr.join("|")})$`),no=new RegExp(`.*\\.${to}$`);function _t(t){let e=io(t.host),r=uo(e,t.domainToMappings),o=ao(t.protoPath,t.data||{});return mo(o,r)}function ao(t,e){return t.split("/").map(r=>so(r,e)).join("/")}function so(t,e){let r=t.match(eo)||[],o=r[1];if(o){let n=t.replace(r[0],"");return Pe(e,o,t,n)}return t}function io(t){return co(t).replace(ro,"._base_domain_").replace(oo,"._api_base_domain_").replace(no,"*.dev.wix-code.com")}function co(t){return t.replace("create.editorx.com","editor.editorx.com")}function uo(t,e){let r=e[t]||e[Yr];return!r&&fo(t)?e[po]:r}function mo(t,e){let r=e?.find(o=>t.startsWith(o.destPath));return r?r.srcPath+t.slice(r.destPath.length):t}function fo(t){return!!t.match(/\._base_domain_$/)}var po="www._base_domain_";a();a();var Dt=typeof Buffer=="function",En=typeof TextDecoder=="function"?new TextDecoder:void 0,Oe=typeof TextEncoder=="function"?new TextEncoder:void 0,ho="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",tt=Array.prototype.slice.call(ho),Cn=(t=>{let e={};return t.forEach((r,o)=>e[r]=o),e})(tt);var b=String.fromCharCode.bind(String),Nn=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),lo=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_");var yo=t=>{let e,r,o,n,s="",i=t.length%3;for(let c=0;c<t.length;){if((r=t.charCodeAt(c++))>255||(o=t.charCodeAt(c++))>255||(n=t.charCodeAt(c++))>255)throw new TypeError("invalid character found");e=r<<16|o<<8|n,s+=tt[e>>18&63]+tt[e>>12&63]+tt[e>>6&63]+tt[e&63]}return i?s.slice(0,i-3)+"===".substring(i):s},ke=typeof btoa=="function"?t=>btoa(t):Dt?t=>Buffer.from(t,"binary").toString("base64"):yo,vo=Dt?t=>Buffer.from(t).toString("base64"):t=>{let r=[];for(let o=0,n=t.length;o<n;o+=4096)r.push(b.apply(null,t.subarray(o,o+4096)));return ke(r.join(""))};var go=t=>{if(t.length<2){var e=t.charCodeAt(0);return e<128?t:e<2048?b(192|e>>>6)+b(128|e&63):b(224|e>>>12&15)+b(128|e>>>6&63)+b(128|e&63)}else{var e=65536+(t.charCodeAt(0)-55296)*1024+(t.charCodeAt(1)-56320);return b(240|e>>>18&7)+b(128|e>>>12&63)+b(128|e>>>6&63)+b(128|e&63)}},Ao=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,_o=t=>t.replace(Ao,go),qe=Dt?t=>Buffer.from(t,"utf8").toString("base64"):Oe?t=>vo(Oe.encode(t)):t=>ke(_o(t)),Ee=(t,e=!1)=>e?lo(qe(t)):qe(t);function Ce(t,e=""){let r={};return Object.entries(t).forEach(([o,n])=>{let s=n!==null&&typeof n=="object"&&!Array.isArray(n),i=xo(e,o);if(s){let c=Ce(n,i);Object.assign(r,c)}else r[i]=n}),r}function xo(t,e){return`${t}${t?".":""}${e}`}function xt(t,e){let r=Ce(t),o=Object.entries(r).reduce((n,[s,i])=>((Array.isArray(i)?i:[i]).forEach(u=>{u!=null&&n.append(s,u)}),n),new URLSearchParams);return e&&o.append(".r",Ee(JSON.stringify(t),!0)),o}a();a();var v;(function(t){t[t.TO_JSON=0]="TO_JSON",t[t.FROM_JSON=1]="FROM_JSON"})(v||(v={}));a();function Ne(t,e={},r){return function(n={},s){return typeof n=="string"?n:i(t,n);function i(p,h){let y={};return[null,void 0].includes(h)?h:(Object.entries(h).forEach(([X,C])=>{let zr=p[X],{schemaName:ht,schemaType:Br}=be(zr),Kr=Br==="Map",Vr=u(ht)?.checkRepetable?.(C)??Array.isArray(C),lt;Vr?lt=C.map(Hr=>c(Hr,ht)):Kr?lt=m(C,ht):lt=c(C,ht),y[X]=lt}),y)}function c(p,h){if(!h)return p;let y=e[h];if(u(h))return u(h).transform(p);if(y)return i(y,p);throw new Error(`${h} is neither schema nor serializable type`)}function u(p){return r[p]?.[s]}function m(p,h){return Object.entries(p).reduce((y,[X,C])=>(y[X]=c(C,h),y),{})}}}a();a();var Fe={types:["google.protobuf.Timestamp"],[v.TO_JSON]:{transform:t=>t?.toISOString()},[v.FROM_JSON]:{transform:t=>t?new Date(t):void 0}};a();var Ie={types:["google.protobuf.FieldMask"],[v.TO_JSON]:{transform:t=>t.join(","),checkRepetable:t=>t.some(e=>Array.isArray(e))},[v.FROM_JSON]:{transform:t=>typeof t=="object"?t.paths:t.split(",")}};a();var De={types:["google.protobuf.BytesValue","BYTES"],[v.TO_JSON]:{transform:t=>{let e=t.reduce((r,o)=>r+String.fromCharCode(o),"");return btoa(e)}},[v.FROM_JSON]:{transform:t=>Uint8Array.from(atob(t),e=>e.charCodeAt(0))}};a();var Je={types:["google.protobuf.Duration"],[v.TO_JSON]:{transform:({seconds:t="0",nanos:e=0})=>{let r="";return e!==0&&(r=`.${e.toString().padStart(9,"0")}`),`${t}${r}s`}},[v.FROM_JSON]:{transform:t=>{let[e,r]=t.substring(0,t.length-1).split(".");return{seconds:e,nanos:wo(r)}}}};function wo(t){let e=0;if(t!==void 0){let r=3-t.length/3;e=parseInt(t,10)*Math.pow(1e3,r)}return e}a();var Ue={types:["FLOAT","DOUBLE","google.protobuf.FloatValue","google.protobuf.DoubleValue"],[v.TO_JSON]:{transform:t=>isFinite(t)?t:t.toString()},[v.FROM_JSON]:{transform:t=>t==="NaN"?NaN:t==="Infinity"?1/0:t==="-Infinity"?-1/0:t}};var Me=[Fe,Ie,De,Je,Ue];a();function Le(t){return t.reduce((e,r)=>{let o=r.types.reduce((n,s)=>({...n,[s]:r}),{});return{...e,...o}},{})}var So=Le([...Me]);function P(t,e={}){let r=Ne(t,e,So);return{fromJSON(o){let n=Ro(o)||o;return r(n,v.FROM_JSON)},toJSON(o){return r(o,v.TO_JSON)}}}function Ro(t){try{return JSON.parse(t)}catch{}}var To={dateCreated:"google.protobuf.Timestamp",dateUpdated:"google.protobuf.Timestamp"},bo={account:"_account"};var Po={};function Oo(t){var e={"api._api_base_domain_":[{srcPath:"/account-server",destPath:""}],"www._base_domain_":[{srcPath:"/_api/account-server",destPath:""}],"manage._base_domain_":[{srcPath:"/_api/account-server",destPath:""},{srcPath:"/account-server",destPath:""}],"premium._base_domain_":[{srcPath:"/_api/account-server",destPath:""}],"editor._base_domain_":[{srcPath:"/_api/account-server",destPath:""}],"blocks._base_domain_":[{srcPath:"/_api/account-server",destPath:""}],"create.editorx":[{srcPath:"/_api/account-server",destPath:""}],"bo._base_domain_":[{srcPath:"/account-server",destPath:""}],"wixbo.ai":[{srcPath:"/account-server",destPath:""}],"www.wixapis.com":[{srcPath:"/accounts",destPath:""}],"users._base_domain_":[{srcPath:"/_api/account-server",destPath:""}],"*.dev.wix-code.com":[{srcPath:"/_api/account-server",destPath:""}]};return _t(Object.assign(t,{domainToMappings:e}))}function ze(t){var e=P(Po,{}),r=e.toJSON,o=e.fromJSON,n=P(bo,{_account:To}).fromJSON;function s(i){var c=i.host,u=r(t),m={entityFqdn:"wix.identity.account.v2.account",method:"GET",methodFqn:"com.wixpress.account.api.AccountService.getMyAccount",url:Oo({protoPath:"/v1/accounts/my_account",data:u,host:c}),params:xt(u),transformResponse:n};return m}return s.fromReq=o,s.__isAmbassador=!0,s}a();var qo={},ko={};var Eo={body:"BYTES"},Co={body:"BYTES"},No={},Fo={};function Jt(t){var e={"manage._base_domain_":[{srcPath:"/oauth2",destPath:"/v1/oauth"}],"www.wixapis.com":[{srcPath:"/oauth2",destPath:"/v1/oauth"},{srcPath:"/oauth2/token_info",destPath:"/v1/token_info"}],"users._base_domain_":[{srcPath:"/v1/oauth/device/verify",destPath:"/v1/oauth/device/verify"},{srcPath:"/v1/oauth/manage/user-code",destPath:"/v1/oauth/manage/user-code"},{srcPath:"/v2/oauth/device/verify",destPath:"/v2/oauth/device/verify"}],_:[{srcPath:"/_api/oauth2",destPath:"/v1/oauth"}]};return _t(Object.assign(t,{domainToMappings:e}))}function Ut(t){var e=P(Eo,{}),r=e.toJSON,o=e.fromJSON,n=P(Co,{}).fromJSON;function s(i){var c=i.host,u=r(t),m={entityFqdn:"wix.identity.oauth.v1.refresh_token",method:"POST",methodFqn:"wix.identity.oauth2.v1.Oauth2Ng.Token",url:Jt({protoPath:"/v1/oauth/token",data:u,host:c}),data:u,transformResponse:n};return m}return s.fromReq=o,s.__isAmbassador=!0,s}function Be(t){var e=P(qo,{}),r=e.toJSON,o=e.fromJSON,n=P(ko,{}).fromJSON;function s(i){var c=i.host,u=r(t),m={entityFqdn:"wix.identity.oauth.v1.refresh_token",method:"GET",methodFqn:"wix.identity.oauth2.v1.Oauth2Ng.DeviceCode",url:Jt({protoPath:"/v1/oauth/device/code",data:u,host:c}),params:xt(u),transformResponse:n};return m}return s.fromReq=o,s.__isAmbassador=!0,s}function Ke(t){var e=P(No,{}),r=e.toJSON,o=e.fromJSON,n=P(Fo,{}).fromJSON;function s(i){var c=i.host,u=r(t),m={entityFqdn:"wix.identity.oauth.v1.refresh_token",method:"POST",methodFqn:"wix.identity.oauth2.v1.Oauth2Ng.RevokeRefreshToken",url:Jt({protoPath:"/v1/oauth/revoke",data:u,host:c}),data:u,transformResponse:n};return m}return s.fromReq=o,s.__isAmbassador=!0,s}a();var He=d(Ct(),1);a();var Ve=d(Ct(),1);function et(t){return Ve.HttpClient.isHttpError(t)}var Io={backoffice:"https://manage.wix.com",editor:"https://editor.wix.com",code:"https://code.wix.com",general:"https://www.wix.com",standalone:void 0};function k(t,e){return(...r)=>e.apply(t,r).catch(o=>{throw et(o)&&!t.isCancel(o)&&!o.response?new l({code:g.NetworkError({cause:o}),cause:o,info:{code:o.code}}):o})}function wt({getAppToken:t,createHeaders:e,type:r}){let o=(0,He.createHttpClient)({baseURL:Io[r],...r!=="standalone"?{getAppToken:t}:{},createHeaders:()=>({...e?.(),"X-XSRF-TOKEN":"nocheck",Cookie:"XSRF-TOKEN=nocheck","User-Agent":"wix-cli"})});return{...o,request:k(o,o.request),get:k(o,o.get),delete:k(o,o.delete),head:k(o,o.head),options:k(o,o.options),post:k(o,o.post),put:k(o,o.put),patch:k(o,o.patch)}}var V=d(T(),1);a();var je=f.object({deviceCode:f.string(),verificationUri:f.string().url(),userCode:f.string(),expiresIn:f.number()}),Mt=f.object({access_token:f.string(),refresh_token:f.string(),expires_in:f.number()}).transform(t=>({accessToken:t.access_token,refreshToken:t.refresh_token,expiresIn:t.expires_in})),Lt=f.object({userId:f.string().uuid(),email:f.string().email()}),We=f.object({account:f.object({slug:f.string(),accountId:f.string().uuid(),accountOwner:f.string().uuid()})}),zt=f.object({accessToken:f.string(),refreshToken:f.string(),expiresIn:f.number(),issuedAt:f.number()}),$e=zt.extend({userInfo:Lt}),Ge=f.object({token:f.string(),accountId:f.string().uuid(),userInfo:f.object({userId:f.string().uuid(),email:f.string()})});var{InvalidResponseData:Do,FailedToGetAuthToken:Jo,FailedToGetDeviceCode:Uo,FailedToRenewAuthToken:Mo,FailedToRenewAuthTokenSiteNotFound:Lo,FailedToRevokeRefreshToken:zo}=g,Bt="6f95cec8-3e98-48b9-b4e5-1fb92fcd9973",Xe=()=>Math.floor(Date.now()/1e3),rt=class extends Error{},K=(0,V.variant)({TokenRenewed:(0,V.payload)(),RefreshTokenRevoked:(0,V.fields)()}),Kt=class{constructor(e){this.httpClient=e;let{minRetryTimeout:r}=L();this.retryOptions={retries:3,minTimeout:r,maxTimeout:3*1e3}}retryOptions;async requestDeviceCode(e={}){try{let{data:r}=await Q(()=>this.httpClient.request(Be({...e,clientId:Bt})),this.retryOptions);return je.parse(r)}catch(r){throw new l({code:Uo(),cause:r})}}async createToken(e){try{let r={clientId:Bt,grantType:"urn:ietf:params:oauth:grant-type:device_code",scope:"offline_access",...e};return{...await Q(async()=>{let{data:n,requestId:s}=await this.httpClient.request(Ut(r)),i=Mt.safeParse(n);if(i.success)return i.data;throw new l({code:Do(),cause:i.error,info:{requestId:s,data:n}})},this.retryOptions),issuedAt:Xe()}}catch(r){throw et(r)&&(r.response?.data?.message==="Device code is not yet verified"||r.response?.data?.error==="authorization_pending")?new rt("Device code is not yet verified."):new l({code:Jo(),cause:r})}}async renewToken(e){try{let r={clientId:Bt,grantType:"refresh_token",...e},{data:o}=await Q(()=>this.httpClient.request(Ut(r)),this.retryOptions),n=Mt.parse(o);return K.TokenRenewed({...n,issuedAt:Xe()})}catch(r){if(et(r)){if(r.response?.status===400&&r.response?.data?.error==="invalid_grant")return K.RefreshTokenRevoked({cause:r});if(e.siteId&&r.response?.status===404&&r.response?.data?.details?.applicationError?.code==="SITE_NOT_FOUND")throw new l({code:Lo({siteId:e.siteId}),cause:r})}throw new l({code:Mo(),cause:r})}}async revokeRefreshToken(e,{email:r}){try{let{data:o}=await this.httpClient.request(Ke(e));return o}catch(o){throw new l({code:zo({email:r}),info:{email:r},cause:o})}}async userInfo({accessToken:e}){try{let r=wt({type:"backoffice",getAppToken:async()=>e}),{data:o}=await r.get("/_serverless/wix-cli-userinfo/userinfo");return Lt.parse(o)}catch(r){throw new l({code:g.FailedToGetUserInfo(),cause:r})}}async getMyAccount({token:e}){try{let r=wt({type:"backoffice",getAppToken:async()=>e}),{data:o}=await r.request(ze({}));return We.parse(o).account}catch(r){throw new l({code:g.FailedToGetMyAccount(),cause:r})}}},S=new Kt(wt({type:"backoffice"}));a();import{unlink as Bo,rm as Ko}from"node:fs/promises";import{resolve as nt}from"node:path";var _=d(T(),1);function Ye(){return nt(Ft(),"auth.json")}function St(){return nt(Ft(),"auth")}function Ze(){return nt(St(),"api-key.json")}function Qe(){return nt(St(),"account.json")}function tr(t){return nt(St(),`${t}.json`)}var Ht=(0,_.variant)({Authenticated:(0,_.payload)(),Unauthenticated:{}});async function jt(){let t=Ze();if(!await Z(t))return Ht.Unauthenticated();let e=await yt(t),r=Ge.parse(e);return Ht.Authenticated(r)}async function er(t){try{let e=Ze();await Nt(e,t)}catch(e){throw new l({code:g.FailedToSaveApiKeyAuthData({cause:e}),cause:e})}}var ot=(0,_.variant)({Authenticated:(0,_.fields)(),Unauthenticated:{},Expired:(0,_.fields)()});async function at(){let t=Qe();if(!await Z(t))return ot.Unauthenticated();let e=await yt(t),r=$e.parse(e);return j(r)?ot.Authenticated(r):ot.Expired(r)}var Vt=(0,_.variant)({Authenticated:(0,_.fields)(),Unauthenticated:{},Expired:(0,_.fields)()});async function rr(t){let e=tr(t);if(!await Z(e))return Vt.Unauthenticated();let r=await yt(e),o=zt.parse(r);return j(o)?Vt.Authenticated(o):Vt.Expired(o)}async function st(t,e){try{let r=e?tr(e):Qe();await Nt(r,t)}catch(r){throw new l({code:g.FailedToSaveAuthData({cause:r}),cause:r})}}async function H(){try{await Ko(St(),{recursive:!0,force:!0})}catch(t){throw new l({code:g.FailedToDeleteAuthData({cause:t}),cause:t})}await Wt()&&await Vo()}async function Vo(){try{await Bo(Ye())}catch(t){throw new l({code:g.FailedToDeleteLegacyAuthData({cause:t}),cause:t})}}async function Wt(){return Z(Ye())}function j(t){let e=Math.floor(Date.now()/1e3),r=10*60,o=t.expiresIn-r;return t.issuedAt+o>e}async function Ho(){let t=await jt();if((0,_.isType)(t,Ht.Authenticated))return t.payload.userInfo;let e=await at();return(0,_.match)(e,{Authenticated:({userInfo:r})=>r,Expired:({userInfo:r})=>r,Unauthenticated:()=>null})}function or({authData:{token:t,accountId:e,userInfo:r},siteId:o}){return{getAccessToken:async()=>t,getRefreshToken:()=>{throw new Error("API key auth does not support refresh tokens")},getRequestHeaders:()=>({"wix-account-id":e,...o&&{"wix-site-id":o}}),userInfo:r}}var I={async isLoggedIn({siteId:t}={}){let e=await jt();return(0,nr.match)(e,{Authenticated:({payload:r})=>or({authData:r,siteId:t}),Unauthenticated:()=>null})},async login({token:t}){let{accountId:e,accountOwner:r,slug:o}=await S.getMyAccount({token:t}),n={token:t,accountId:e,userInfo:{userId:r,email:o}};return await H(),await er(n),or({authData:n})}};a();a();a();var $t=class{value;next;constructor(e){this.value=e}},it=class{#t;#e;#r;constructor(){this.clear()}enqueue(e){let r=new $t(e);this.#t?(this.#e.next=r,this.#e=r):(this.#t=r,this.#e=r),this.#r++}dequeue(){let e=this.#t;if(e)return this.#t=this.#t.next,this.#r--,e.value}clear(){this.#t=void 0,this.#e=void 0,this.#r=0}get size(){return this.#r}*[Symbol.iterator](){let e=this.#t;for(;e;)yield e.value,e=e.next}};function ct(t){if(!((Number.isInteger(t)||t===Number.POSITIVE_INFINITY)&&t>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");let e=new it,r=0,o=()=>{r--,e.size>0&&e.dequeue()()},n=async(c,u,m)=>{r++;let p=(async()=>c(...m))();u(p);try{await p}catch{}o()},s=(c,u,m)=>{e.enqueue(n.bind(void 0,c,u,m)),(async()=>(await Promise.resolve(),r<t&&e.size>0&&e.dequeue()()))()},i=(c,...u)=>new Promise(m=>{s(c,m,u)});return Object.defineProperties(i,{activeCount:{get:()=>r},pendingCount:{get:()=>e.size},clearQueue:{value:()=>{e.clear()}}}),i}var E=d(T(),1);a();a();var W=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},Gt=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}},ar=t=>globalThis.DOMException===void 0?new Gt(t):new DOMException(t),sr=t=>{let e=t.reason===void 0?ar("This operation was aborted."):t.reason;return e instanceof Error?e:ar(e)};function Xt(t,e){let{milliseconds:r,fallback:o,message:n,customTimers:s={setTimeout,clearTimeout}}=e,i,u=new Promise((m,p)=>{if(typeof r!="number"||Math.sign(r)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${r}\``);if(e.signal){let{signal:y}=e;y.aborted&&p(sr(y)),y.addEventListener("abort",()=>{p(sr(y))})}if(r===Number.POSITIVE_INFINITY){t.then(m,p);return}let h=new W;i=s.setTimeout.call(void 0,()=>{if(o){try{m(o())}catch(y){p(y)}return}typeof t.cancel=="function"&&t.cancel(),n===!1?m():n instanceof Error?p(n):(h.message=n??`Promise timed out after ${r} milliseconds`,p(h))},r),(async()=>{try{m(await t)}catch(y){p(y)}})()}).finally(()=>{u.clear()});return u.clear=()=>{s.clearTimeout.call(void 0,i),i=void 0},u}var Yt=Symbol("resolveValue");async function ut(t,e={}){let{interval:r=20,timeout:o=Number.POSITIVE_INFINITY,before:n=!0}=e,s,i=!1,c=new Promise((u,m)=>{let p=async()=>{try{let h=await t();if(typeof h=="object"&&h[Yt])u(h[Yt]);else{if(typeof h!="boolean")throw new TypeError("Expected condition to return a boolean");h===!0?u():i||(s=setTimeout(p,r))}}catch(h){m(h)}};n?p():s=setTimeout(p,r)});if(o===Number.POSITIVE_INFINITY)return c;try{return await Xt(c,typeof o=="number"?{milliseconds:o}:o)}finally{i=!0,clearTimeout(s)}}ut.resolveWith=t=>({[Yt]:t});var ir=t=>1e3*t;async function jo({deviceCode:t,expiresIn:e},{signal:r}){try{let o=await ut(async()=>{try{let i=await S.createToken({deviceCode:t});return ut.resolveWith(i)}catch(i){if(i instanceof rt)return!1;throw i}},{interval:L().waitForLoginInterval??ir(3),timeout:{milliseconds:ir(e),signal:r}}),n=await S.userInfo({accessToken:o.accessToken}),s={...o,userInfo:n};return await H(),await st(s),s}catch(o){throw o instanceof W?new l({code:g.DeviceCodeTimedOut()}):o}}async function ur({refreshToken:t,userInfo:e}){let r=await S.renewToken({refreshToken:t});return(0,E.isType)(r,K.TokenRenewed)&&await st({...r.payload,userInfo:e}),r}async function Wo(){let t=await at();return(0,E.match)(t,{Authenticated:e=>e,Unauthenticated:()=>null,Expired:async e=>{let r=await ur(e);return(0,E.match)(r,{TokenRenewed:({payload:o})=>({...o,userInfo:e.userInfo}),RefreshTokenRevoked:(0,E.constant)(null)})}})}function cr({userInfo:t,...e}){let r=ct(1),o={...e};return{getAccessToken:()=>r(async()=>{if(j(o))return o.accessToken;let n=await ur({...o,userInfo:t});return(0,E.match)(n,{TokenRenewed:({payload:s})=>(o=s,o.accessToken),RefreshTokenRevoked:({cause:s})=>{throw new l({code:g.FailedToRenewAuthTokenRefreshTokenRevoked(),cause:s})}})}),getRefreshToken:()=>o.refreshToken,userInfo:t}}var O={async isLoggedIn(){let t=await I.isLoggedIn();if(t)return t;let e=await Wo();return e?cr(e):null},async login({deviceCode:t,signal:e}){let r=await jo(t,{signal:e});return cr(r)}};a();var x=d(T(),1);async function pr({accountRefreshToken:t,siteId:e}){let r=await S.renewToken({refreshToken:t,siteId:e});return(0,x.isType)(r,K.TokenRenewed)&&await st(r.payload,e),r}var Rt=(0,x.variant)({Ok:(0,x.payload)(),RefreshTokenRevoked:(0,x.fields)()});async function mr({siteId:t,accountRefreshToken:e}){let r=await rr(t);return(0,x.matcher)(r).with({Authenticated:o=>Rt.Ok(o)}).when(["Unauthenticated","Expired"],async()=>{let o=await pr({accountRefreshToken:e,siteId:t});return(0,x.match)(o,{TokenRenewed:({payload:n})=>Rt.Ok(n),RefreshTokenRevoked:({cause:n})=>Rt.RefreshTokenRevoked({cause:n})})}).complete()}function fr({siteAuth:t,accountRefreshToken:e,siteId:r,userInfo:o}){let n=ct(1),s={...t};return{getAccessToken:()=>n(async()=>{if(j(s))return s.accessToken;let i=await pr({accountRefreshToken:e,siteId:r});return(0,x.match)(i,{TokenRenewed:({payload:c})=>(s=c,s.accessToken),RefreshTokenRevoked:({cause:c})=>{throw new l({code:g.FailedToRenewAuthTokenRefreshTokenRevoked(),cause:c})}})}),getRefreshToken:()=>s.refreshToken,userInfo:o}}var Zt=t=>({async isLoggedIn(){let e=await I.isLoggedIn({siteId:t});if(e)return e;let r=await O.isLoggedIn();if(r){let o=r.getRefreshToken(),n=await mr({siteId:t,accountRefreshToken:o});if((0,x.isType)(n,Rt.Ok))return fr({siteId:t,siteAuth:n.payload,accountRefreshToken:o,userInfo:r.userInfo})}return null},async login({deviceCode:e,signal:r}){let o=await O.login({deviceCode:e,signal:r}),n=o.getRefreshToken(),s=await mr({siteId:t,accountRefreshToken:n});return(0,x.match)(s,{Ok:({payload:i})=>fr({siteId:t,siteAuth:i,accountRefreshToken:n,userInfo:o.userInfo}),RefreshTokenRevoked:({cause:i})=>{throw new l({code:g.FailedToRenewAuthTokenRefreshTokenRevoked(),cause:i})}})}});a();var dr=d(T(),1);async function $o(){let t=await at();return(0,dr.isType)(t,ot.Unauthenticated)||await S.revokeRefreshToken({token:t.refreshToken},t.userInfo),await H(),null}a();var lr=d(R(),1);a();var hr=d(R(),1),$=(0,hr.createContext)(null);function Qt(){let t=(0,lr.useContext)($);if(!t)throw new Error("useAuth() cannot be used without an <AuthProvider>");return t}a();var yr=d(R(),1);var vr=d(T(),1);var Go=({token:t,onLogin:e,onError:r})=>{let o=gt(),{status:n}=q(async()=>(o.report(At({})),I.login({token:t})),[],{onSuccess:s=>{o.report(B({isSuccess:!0})),e(s)},onError:s=>{o.report(B({isSuccess:!1,...s instanceof Error?{errorType:s.name}:{errorType:"unknown",errorMessage:JSON.stringify(s)}})),r(s)}});return(0,vr.match)(n,{Error:()=>null,Loading:()=>yr.default.createElement(U,null),Success:()=>null})};a();var mt=d(R(),1);var Jr=d(T(),1);var Tt={"login.instructions_title":"Authorize the CLI to access your Wix account:","login.instructions_details":`1. Copy this code to the clipboard: <0>{code}</0>
2. Press <1/> to connect to <2/> then paste the code`,"login.legacy_auth_notice":"We implemented a new and more secure login method. You'll need to re-login to continue using the CLI.","login.error_opening_browser":"Failed to open browser, please try opening <0/> manually."};a();var A=d(R(),1);a();var Fr=d(Er(),1);a();var Cr=d(Ct(),1);async function Nr(t,e){await(0,Cr.createHttpClient)().post(t,void 0,{params:{url:e}})}async function Ir(t){let{userBrowserTestEndpoint:e}=L();e?await Nr(e,t):await(0,Fr.default)(t,{background:!0})}var Dr=({userCode:t,verificationUri:e})=>{let{reportError:r}=ve(),[o,n]=(0,A.useState)(null);return me((s,i)=>{i.return&&Ir(e).catch(c=>{r(c),n(c)})}),A.default.createElement(A.default.Fragment,null,A.default.createElement(z,{i18nKey:"login.instructions_title"}),A.default.createElement(Y,{flexDirection:"column",marginTop:1,marginBottom:1,marginLeft:2},A.default.createElement(z,{i18nKey:"login.instructions_details",components:[A.default.createElement(fe,{skin:"legacyBlue"}),A.default.createElement(pe,{value:"enter"}),A.default.createElement(Et,{url:e})],values:{code:t}})),o&&A.default.createElement(A.default.Fragment,null,A.default.createElement(Y,{flexDirection:"column",marginBottom:1},A.default.createElement(le,{error:o})),A.default.createElement(z,{i18nKey:"login.error_opening_browser",components:[A.default.createElement(Et,{url:e})]})))};var ie=({loginFn:t,onLogin:e,onError:r})=>{let o=gt();function n(c){o.report(B({isSuccess:!1,...c instanceof Error?{errorType:c.name}:{errorType:"unknown",errorMessage:JSON.stringify(c)}})),r(c)}let s=de(async({signal:c},u)=>{try{let m=await t({deviceCode:u,signal:c});o.report(B({isSuccess:!0})),e(m)}catch(m){n(m)}}),{status:i}=q(async()=>(o.report(At({})),S.requestDeviceCode()),[],{onSuccess:c=>{s.execute(c)},onError:n});return(0,Jr.match)(i,{Error:()=>null,Loading:()=>mt.default.createElement(U,null),Success:({result:{userCode:c,verificationUri:u}})=>mt.default.createElement(Dr,{userCode:c,verificationUri:u})})};function un(t){return mt.default.createElement(vt,{messages:Tt},mt.default.createElement(ie,{loginFn:O.login,...t}))}a();var ce=d(R(),1);a();var pt=d(R(),1),Lr=d(T(),1);a();var ft=d(R(),1),Ur=d(T(),1);var Mr=({children:t})=>{let{status:e}=q(Wt,[],{onError:()=>{}});return(0,Ur.match)(e,{Error:()=>null,Loading:()=>null,Success:({result:r})=>ft.default.createElement(ft.default.Fragment,null,r&&ft.default.createElement(Y,{marginBottom:1},ft.default.createElement(z,{i18nKey:"login.legacy_auth_notice"})),t)})};var kt=({authStrategy:{login:t,isLoggedIn:e},onLogin:r,onError:o,children:n})=>{let{status:s,merge:i}=q(e,[],{onSuccess:c=>{c&&r(c)},onError:o});return(0,Lr.match)(s,{Loading:()=>pt.default.createElement(U,null),Error:()=>null,Success:({result:c})=>c===null?pt.default.createElement(vt,{messages:Tt},pt.default.createElement(Mr,null,pt.default.createElement(ie,{loginFn:t,onLogin:u=>{i({result:u}),r(u)},onError:o}))):n(c)})};var mn=({children:t,onError:e,onLogin:r})=>{let o=M();return ce.default.createElement(kt,{authStrategy:O,onLogin:({userInfo:n})=>r?.(n),onError:e??o},({getAccessToken:n,getRequestHeaders:s,userInfo:i})=>ce.default.createElement($.Provider,{value:{getAccessToken:n,getRequestHeaders:s,userInfo:i}},t))};a();var dt=d(R(),1);var ue=({children:t,siteId:e,onError:r,onLogin:o})=>{let n=M(),s=(0,dt.useMemo)(()=>Zt(e),[e]);return dt.default.createElement(kt,{authStrategy:s,onLogin:({userInfo:i})=>o?.(i),onError:r??n},({getAccessToken:i,getRequestHeaders:c,userInfo:u})=>dt.default.createElement($.Provider,{value:{getAccessToken:i,getRequestHeaders:c,userInfo:u}},t))};a();var D=d(R(),1);var fn=({onReady:t})=>{let e=M(),r=Qt();return(0,D.useEffect)(()=>{t(r),e()},[e,r,t]),null};function pn(t,e,r){return new Promise((o,n)=>{he(D.default.createElement(ye,{value:r},D.default.createElement(ge,{value:e},D.default.createElement(ue,{siteId:t},D.default.createElement(fn,{onReady:o}))))).catch(n)})}var{isLoggedIn:hc}=O;export{et as a,wt as b,Q as c,_t as d,xt as e,P as f,Ho as g,ct as h,Xt as i,ut as j,$o as k,Qt as l,Go as m,Ir as n,un as o,mn as p,ue as q,pn as r,hc as s};
//# sourceMappingURL=chunk-NWEJ2BHT.js.map
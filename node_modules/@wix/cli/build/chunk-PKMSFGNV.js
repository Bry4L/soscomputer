import { createRequire as _createRequire } from 'node:module';
const require = _createRequire(import.meta.url);
import{a as p,d as _,e as N}from"./chunk-FACL5JC5.js";import{a as m}from"./chunk-RJJU2M3A.js";import{a as k,d as y,e as D,f as d,j as h}from"./chunk-NWEJ2BHT.js";import{f as w}from"./chunk-3JLE6D3G.js";import{e as P,f as v,g as R,h as x}from"./chunk-FCAB5YK5.js";import{c as o,e as i}from"./chunk-JOXYEZYT.js";import{i as r}from"./chunk-UO4ZAUJK.js";r();import j from"node:path";var U=async e=>R(j.join(e,"yarn.lock")),X=async e=>await U(e)?"yarn":"npm";r();r();var W={},I={};var Y={},$={};function q(e){var t={"api._api_base_domain_":[{srcPath:"/wix-code-user-code-dependencies",destPath:""}],"editor._base_domain_":[{srcPath:"/wix-code-user-code-dependencies",destPath:""}],"blocks._base_domain_":[{srcPath:"/wix-code-user-code-dependencies",destPath:""}],"create.editorx":[{srcPath:"/wix-code-user-code-dependencies",destPath:""}]};return y(Object.assign(e,{domainToMappings:t}))}function F(e){var t=d(Y,{}),n=t.toJSON,a=t.fromJSON,s=d($,{}).fromJSON;function c(g){var u=g.host,l=n(e),f={entityFqdn:"wix.velo.npm.v1.npm_package_info",method:"POST",methodFqn:"wix.velo.npm.v1.UserCodeNpmPackages.ResolveNpmDependencies",url:q({protoPath:"/v1/npm/resolve-dependencies",data:l,host:u}),data:l,transformResponse:s};return f}return c.fromReq=a,c.__isAmbassador=!0,c}function O(e){var t=d(W,{}),n=t.toJSON,a=t.fromJSON,s=d(I,{}).fromJSON;function c(g){var u=g.host,l=n(e),f={entityFqdn:"wix.velo.npm.v1.npm_package_info",method:"GET",methodFqn:"wix.velo.npm.v1.UserCodeNpmPackages.GetResolveNpmDependenciesResult",url:q({protoPath:"/v1/npm/resolve-dependencies/{jobId}",data:l,host:u}),params:D(l),transformResponse:s};return f}return c.fromReq=a,c.__isAmbassador=!0,c}r();import{join as J}from"node:path";async function C(e){let t=J(e,"package.json"),n=await v(t);return Object.entries(n.dependencies??{}).map(([a,s])=>({name:a,version:s}))}async function ie(e,t){let n=J(e,"package.json"),a=await v(n);if(a.dependencies&&Object.keys(a.dependencies).length>0)throw new o({code:i.FailedMigrationToAnyNpm()});a.dependencies={},Object.keys(t.dependencies).forEach(s=>{a.devDependencies&&a.devDependencies[s]&&delete a.devDependencies[s],a.dependencies[s]=t.dependencies[s]}),await P(n,a)}r();import{join as z}from"node:path";async function S(e,t){let n=z(e,w);try{await x(n,t)}catch(a){throw new o({code:i.FailedToWriteWixLock(),cause:a})}}var G=async(e,{authState:t})=>h(async()=>{try{let{data:n}=await m({type:"editor",authState:t},O({jobId:e})),a=N.parse(n);return h.resolveWith({wixLockFileUrl:a.result.npmDependenciesLockFile})}catch(n){if(k(n)&&n.response?.status===428)return!1;throw new o({code:i.FailedToGetResolveNpmDependenciesResult(),cause:n})}},{interval:3*1e3,timeout:2*60*1e3}),V=async(e,t)=>{let n=await m({type:"standalone"},{url:e});return S(t,n.data)},De=async(e,{authState:t})=>{try{let n=await C(e),{data:a}=await m({type:"editor",authState:t},F({npmPackageInfos:n})),{jobId:s}=_.parse(a),{wixLockFileUrl:c}=await G(s,{authState:t});await V(c,e)}catch(n){throw new o({code:i.FailedToResolveNpmDependencies(),cause:n})}};r();r();var T=async(e,t,n)=>{let a=["add",`${e}${t?`@${t}`:""}`];return p("yarn",a,{cwd:n})},A=(e,t)=>p("yarn",["remove",e],{cwd:t}),E=e=>p("yarn",["install"],{cwd:e});r();var b=async(e,t,n)=>{let a=["install",`${e}${t?`@${t}`:""}`];return p("npm",a,{cwd:n})},L=(e,t)=>p("npm",["uninstall",e],{cwd:t}),M=e=>p("npm",["install"],{cwd:e});var be=async(e,t,n,a)=>{try{a==="yarn"?await T(e,t,n):await b(e,t,n)}catch(s){throw new o({code:i.FailedToInstallPackage({packageName:e,cause:s}),cause:s})}},Le=async(e,t,n)=>{try{n==="yarn"?await A(e,t):await L(e,t)}catch(a){throw new o({code:i.FailedToUninstallPackage({packageName:e,cause:a}),cause:a})}},Me=async(e,t)=>{try{t==="yarn"?await E(e):await M(e)}catch(n){throw new o({code:i.FailedToInstallPackages({cause:n}),cause:n})}};export{X as a,ie as b,De as c,be as d,Le as e,Me as f};
//# sourceMappingURL=chunk-PKMSFGNV.js.map